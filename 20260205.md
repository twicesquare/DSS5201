# 20260205

## 表链接
### inner join
只返回两个表中，具有匹配值的行

`a_b = a.merge(b, on='index', suffixes=('_a','_b'))`

`suffix`是对于相同名称的列，为了区别而自己设置一个后缀

#### 一对多关系
#### 链接多个表
![](https://cdn.jsdelivr.net/gh/twicesquare/pics@main/20260205121822715.png)
`\`使得前后被视作同一行代码

`as_index=False`:

这是一个非常实用的设置。它确保分组的字段在结果中保持为普通的列，而不是变成索引（Index）。

`sort_values(by=['vacant','account','pop_2010'], ascending=[False, True,True])`

`sort_values`的用法，by和ascending，以及中括号

### 左链接
返回所有来自左表的数据，以及右表的关键列匹配的行

![](https://cdn.jsdelivr.net/gh/twicesquare/pics@main/20260205133707090.png)
`how`默认是inner,此处用于指定left

```
# Count the number of rows in the budget column that are missing
number_of_missing_fin = movies_financials['budget'].isna().sum()
```

### right join
![](https://cdn.jsdelivr.net/gh/twicesquare/pics@main/20260205134349361.png)
如果左右表中的on列不是一个名字

### outer join
返回所有行

### 自链接
![](https://cdn.jsdelivr.net/gh/twicesquare/pics@main/20260205135634009.png)

### 练习
`groupby`以及`agg`
```
# Count the number of genres
genre_count = genres_movies.groupby('genre').agg({'id':'count'})
```

`isnull`选择出那些空行
```
# From action_scifi, select only the rows where the genre_act column is null
scifi_only = action_scifi[action_scifi['genre_act'].isnull()]
```

**在 Pandas 中，isnull() 和 isna() 完全没有区别。**

## 使用索引index连接表
![](https://cdn.jsdelivr.net/gh/twicesquare/pics@main/20260205140234348.png)
当使用left_on和right_on时，需要设置left_index和right_index

### 练习
```
# Merge sequels and financials on index id
sequels_fin = sequels.merge(financials, on='id', how='left')

# Self merge with suffixes as inner join with left on sequel and right on id
orig_seq = sequels_fin.merge(sequels_fin, how='inner', left_on='sequel', 
                             right_on='id', right_index=True,
                             suffixes=('_org','_seq'))

# Add calculation to subtract revenue_org from revenue_seq 
orig_seq['diff'] = orig_seq['revenue_seq'] - orig_seq['revenue_org']

# Select the title_org, title_seq, and diff 
# 注意双中括号！
titles_diff = orig_seq[['title_org','title_seq','diff']]

# Print the first rows of the sorted titles_diff
print(titles_diff.sort_values(by='diff',ascending=False).head())
```
外层的 `[]`是 Pandas 的索引操作符。

内层的 `[]` 是 Python 的列表符号。
